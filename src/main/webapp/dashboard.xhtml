<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:po="http://primefaces.org/rain"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/main.xhtml">

    <ui:define name="title">Dashboard</ui:define>
    <ui:define name="head">
        <link rel="stylesheet" href="/webjars/font-awesome/6.4.0/css/all.min.css"/>
        <h:outputScript name="js/chart.js"/>
        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
    </ui:define>


    <ui:define name="content">
        <div class="layout-dashboard">
            <div class="grid">





                <!-- ....................................ADMIN VIEW START................................... -->
                <c:if test="#{sessionInfoBean.hasRole('ADMIN')}">
                    <!-- ................TOP INFO BOXES.......... -->
                    <!-- ...........USERS SIGNED UP............ -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card  overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-useronline.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/icon-usersonline.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">USERS SIGNED UP</span>
                                <h3>
                                    <h:outputText value="#{userListController.usersAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- .............ACCESS POINTS........... -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-checkins.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/icon-checkins.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">ACCESS POINTS</span>
                                <h3>
                                    <h:outputText value="#{accessPointController.accessPointsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- ..............PLANTS UNDER CARE.............. -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box ">
                            <p:graphicImage url="../resources/images/dashboard/effect-filessynced.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/plants.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">PLANTS UNDER CARE</span>
                                <h3>
                                    <h:outputText value="#{sensorStationListController.sensorStationsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- .............MEASUREMENTS............... -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-messages.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/icon-messages.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">MEASUREMENTS</span>
                                <h3>
                                    <h:outputText value="#{measurementListController.measurementsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>



                    <!-- ..........GRAPH................ -->
                    <div class="col-12 md:col-12 xl:col-6">
                        <div class="card chart">
                            <div class="card-header">
                                <h5>Selected GreenHouse Details</h5>
                            </div>
                            <div class="card">
                                <p:barChart id="myBarChart" model="#{graphController.barModel}"/>

                            </div>
                        </div>
                    </div>
                    <!-- ......simply modify the graph controller do display different data....... -->
                    <!-- ......supported charts are .lineModel and .cartesianLinearModel...... -->


                    <!-- ..........GREENHOUSES PREVIEW........... -->
                    <div class="col-12 md:col-12 xl:col-6">
                        <div class="col-12">
                            <div class="card">
                                <h5>Green Houses</h5>
                                <p:dataTable id="ordersTable" var="sensorStation"
                                             value="#{sensorStationListController.sensorStations}" selectionMode="single"
                                             reflow="true" paginatorPosition="bottom"
                                             rowKey="#{sensorStation.sensorStationName}" paginator="true" rows="5"
                                             sortBy="#{sensorStation.sensorStationName}" sortOrder="descending">

                                    <!-- ...........ROW SELECTION EVENT................ -->
                                    <p:ajax event="rowSelect" update="myBarChart"
                                            listener="#{graphController.onRowSelect}"/>

                                    <p:column headerText="Id" sortBy="#{sensorStation.sensorStationName}">
                                        <h:outputText value="#{sensorStation.id}"/>
                                    </p:column>

                                    <p:column headerText="Plant" sortBy="#{sensorStation.plant}">
                                        <h:outputText value="#{sensorStation.plant}"/>
                                    </p:column>

                                    <!-- ...........THIS HAS TO CHANGE WITH PLANT DATE!!!!!!!!......... -->
                                    <p:column headerText="Date" sortBy="#{sensorStation.createDate}">
                                        <h:outputText value="#{sensorStation.createDate}"/>
                                    </p:column>

                                    <p:column headerText="Location" sortBy="#{sensorStation.location}">
                                        <h:outputText value="#{sensorStation.location}">
                                        </h:outputText>
                                    </p:column>


                                    <p:column headerText="Status">
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('AIR_PRESSURE')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('AIR_PRESSURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Air Pressure"></i>
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('TEMPERATURE')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('TEMPERATURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Temperature"></i>
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('SOIL_MOISTURE')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('SOIL_MOISTURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Soil Moisture"></i>
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('AIR_QUALITY')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('AIR_QUALITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Air Quality"></i>
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('LIGHT_INTENSITY')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('LIGHT_INTENSITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Light Intensity"></i>
                                        <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('HUMIDITY')}"
                                           style="color:#{sensorStationDetailController.getlastMeasurementStatus('HUMIDITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                           title="Humidity"></i>
                                    </p:column>

                                    <p:column style="width: 3.5rem">

                                        <!-- ...........BUTTON TO OPEN DETAILVIEW OF SELECTED SENSOR STATION......... -->
                                        <p:button icon="pi pi-search"
                                                  title="open Detail-View"
                                                  href="/greenHouseDetails.xhtml?id=#{sensorStation.sensorStationName}"/>

                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </div>
                </c:if>
                <!-- ....................................ADMIN VIEW FINISH................................... -->













                <!-- ....................................GARDENER VIEW START................................... -->
                <c:if test="#{sessionInfoBean.hasRole('GARDENER')}">  <!-- ........................not needed?................... -->
                <!-- ..........GRAPH................ -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="card chart">
                        <div class="card-header">
                            <h5>Selected Plant Details</h5>
                        </div>
                        <div class="card">
                            <p:barChart id="myBarChart2" model="#{graphController.barModel}"/>

                        </div>
                    </div>
                </div>
                <!-- ......simply modify the graph controller do display different data....... -->
                <!-- ......supported charts are .lineModel and .cartesianLinearModel...... -->


                <!-- ..........GREENHOUSES PREVIEW........... -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="col-12">
                        <div class="card">
                            <h5>Assigned Plants</h5>
                            <p:dataTable id="ordersTable2" var="sensorStation"
                                         value="#{sensorStationListController.assignedSensorStations}" selectionMode="single"
                                         reflow="true" paginatorPosition="bottom"
                                         rowKey="#{sensorStation.sensorStationName}" paginator="true" rows="5"
                                         sortBy="#{sensorStation.sensorStationName}" sortOrder="descending">

                                <!-- ...........ROW SELECTION EVENT................ -->
                                <p:ajax event="rowSelect" update="myBarChart2"
                                        listener="#{graphController.onRowSelect}"/>

                                <p:column headerText="Id" sortBy="#{sensorStation.sensorStationName}">
                                    <h:outputText value="#{sensorStation.id}"/>
                                </p:column>

                                <p:column headerText="Plant" sortBy="#{sensorStation.plant}">
                                    <h:outputText value="#{sensorStation.plant}"/>
                                </p:column>

                                <!-- ...........THIS HAS TO CHANGE WITH PLANT DATE!!!!!!!!......... -->
                                <p:column headerText="Date" sortBy="#{sensorStation.createDate}">
                                    <h:outputText value="#{sensorStation.createDate}"/>
                                </p:column>

                                <p:column headerText="Location" sortBy="#{sensorStation.location}">
                                    <h:outputText value="#{sensorStation.location}">
                                    </h:outputText>
                                </p:column>


                                <p:column headerText="Status">
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('AIR_PRESSURE')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('AIR_PRESSURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Air Pressure"></i>
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('TEMPERATURE')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('TEMPERATURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Temperature"></i>
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('SOIL_MOISTURE')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('SOIL_MOISTURE',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Soil Moisture"></i>
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('AIR_QUALITY')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('AIR_QUALITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Air Quality"></i>
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('LIGHT_INTENSITY')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('LIGHT_INTENSITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Light Intensity"></i>
                                    <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon('HUMIDITY')}"
                                       style="color:#{sensorStationDetailController.getlastMeasurementStatus('HUMIDITY',sensorStation.id) == 'OK' ? 'green' : 'red'}"
                                       title="Humidity"></i>
                                </p:column>

                                <p:column style="width: 3.5rem">

                                    <!-- ...........BUTTON TO OPEN DETAILVIEW OF SELECTED SENSOR STATION......... -->
                                    <p:button icon="pi pi-search"
                                              title="open Detail-View"
                                              href="/greenHouseDetails.xhtml?id=#{sensorStation.sensorStationName}"/>

                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
            </c:if>




                <!-- ....................................GARDENER VIEW FINISH................................... -->















                <!-- ....................................USER VIEW ................................... -->

                <h:form id="userForm">
                    <div class="col-12">

                        <div class="card">
                            <h5>Followed plants</h5>
                            <p:dataTable id="plantsTable" var="plant" value="#{plantController.doGetFollowedPlants()}" paginator="true" rows="3" paginatorPosition="bottom" rowKey="#{plant.id}">

                                <p:ajax event="rowToggle"/>

                                <p:column style="width:2rem">
                                    <p:rowToggler/>
                                </p:column>


                                <p:column >
                                    <p:graphicImage url="../resources/images/plant1.jpg" styleClass="shadow-2" width="100"/>
                                </p:column>

                                <p:column headerText="Plant" sortBy="#{plant.plantName}">
                                    <h:outputText value="#{plant.plantName}"/>
                                </p:column>

                                <p:column headerText="Planted Date" sortBy="#{plant.plantedDate}">
                                    <h:outputText value="#{plant.plantedDate}"/>
                                </p:column>

                                <p:column headerText="Description" sortBy="#{plant.description}">
                                    <h:outputText value="#{plant.description}"/>
                                </p:column>

                                <p:column >

                                    <p:commandButton style="border-color: red; background-color: red"
                                                     icon="pi pi-minus"
                                                     title="Unfollow Plant"
                                                     update=":userForm:plantsTable">
                                        <p:ajax event="click" listener="#{userDetailController.doRemovePlantFromFollowedPlants(plant)}"/>
                                    </p:commandButton>

                                    <p:commandButton value="Show Plant Gallery" icon="pi pi-external-link"
                                                     onclick="PF('galleria1').show()"/>


                                </p:column>


                                <!-- .........................................ROW EXPANSION.......................................................... -->
                                <p:rowExpansion>
                                 put it back
                                </p:rowExpansion>

                            </p:dataTable>


                            <!-- .......::::::::::::::::...GALLERY ....::::::::::::::::::::::.......... -->
                            <div class="card">
                                <p:galleria widgetVar="galleria1" value="#{galleryController.images}" var="image"
                                            numVisible="9"
                                            circular="true" fullScreen="true" showItemNavigators="true"
                                            style="max-width: 70%">
                                    <p:graphicImage value="#{galleryController.photoAsStreamedContent}"
                                                    alt="#{galleryController.photoAsStreamedContent}"
                                                    style="width: 100%; display: block">
                                        <f:param name="id" value="#{image.id}"/>
                                    </p:graphicImage>
                                </p:galleria>
                            </div>







                        </div>
                    </div>
                </h:form>
                <!--.......................................................USER VIEW FINISH.........................................-->








                <!--.......................................................ADMIN LOG.........................................-->
                <c:if test="#{sessionInfoBean.hasRole('ADMIN')}">

                    <!-- ..........OUTER FRAME LOG SYSTEM MESSAGES AND LOGS .............. -->
                    <div class="col-12 md:col-12 xl:col-8">
                        <div class="grid">

                            <!-- ........SYSTEM MESSAGES.......... -->
                            <div class="col-12 md:col-6">
                                <div class="card feedbacks">
                                    <div class="card-header">
                                        <h5>Work in Progress</h5>
                                    </div>
                                </div>
                            </div>


                            <!-- ...........AUDIT LOG FRAME ........... -->
                            <div class="col-12 md:col-6">
                                <div class="card status">
                                    <h:outputLink value="/auditLog.xhtml">
                                        <h5 style="text-align: center; color: grey;">Audit Logs</h5>
                                    </h:outputLink>

                                    <div class="status-content">


                                        <!-- .......AUDIT LOG PREVIEW ....... -->
                                        <div class="card">
                                            <p:dataTable id="logs" var="log" value="#{logController.logs}"
                                                         reflow="true" paginatorPosition="bottom"
                                                         rowKey="#{log.id}" paginator="true" rows="5" sortBy="#{log.id}"
                                                         sortOrder="descending">
                                                <p:column>
                                                    <h:outputText value="#{log.type}"
                                                                  style="color:#{log.type == 'ERROR' ? 'red' : log.type == 'WARNING' ? 'orange' : 'green'};"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{log.time}"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{log.text}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </div>


                                        <!-- .............LOG CATEGORIES ......... -->
                                        <div class="status-info">
                                            <h6>Logs</h6>
                                            <ul>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-info"></i> Total Amount</span>
                                                        <span>
                                                            <h:outputText value="#{logController.logsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on"
                                                                 style="color: red"></i> Error</span>
                                                        <span>
                                                            <h:outputText value="#{logController.errorLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on" style="color: orange"></i> Warning</span>
                                                        <span>
                                                            <h:outputText value="#{logController.warningLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on"
                                                                 style="color: green"></i> Success</span>
                                                        <span>
                                                            <h:outputText value="#{logController.successLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div><!-- ......LOG CATEGORIES END..... -->

                                    </div>
                                </div>
                            </div><!-- .......AUDIT LOG FRAME END....... -->


                        </div>
                    </div><!-- ..END OF OUTER FRAME SYSTEM MESSAGES AND LOGS .......-->


                    <!-- ..........EXTRA FRAME.......... -->
                    <div class="col-12 md:col-6 xl:col-4">
                        <div class="card sales">
                            <div class="card-header">
                                <h5>Work in Progress</h5>
                            </div>
                        </div>
                    </div>
                </c:if>
                <!--.....................................................ADMIN LOG FINISHED............................................-->
            </div>
        </div>
    </ui:define>
</ui:composition>