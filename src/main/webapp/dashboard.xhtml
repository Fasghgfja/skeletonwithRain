<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:po="http://primefaces.org/rain"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/main.xhtml">

    <ui:define name="title">Dashboard</ui:define>
    <ui:define name="head">
        <link rel="stylesheet" href="/webjars/font-awesome/6.4.0/css/all.min.css"/>
        <h:outputScript name="js/chart.js"/>
    </ui:define>


    <ui:define name="content">
        <div class="layout-dashboard">
            <div class="grid">



                <c:if test="#{sessionInfoBean.hasRole('ADMIN') or sessionInfoBean.hasRole('GARDENER')}">
                    <!-- ................TOP INFO BOXES.......... -->
                    <!-- ...........USERS SIGNED UP............ -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card  overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-useronline.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/icon-usersonline.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">USERS SIGNED UP</span>
                                <h3>
                                    <h:outputText value="#{userListController.usersAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- .............ACCESS POINTS........... -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-checkins.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/icon-checkins.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">ACCESS POINTS</span>
                                <h3>
                                    <h:outputText value="#{accessPointController.accessPointsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- ..............PLANTS UNDER CARE.............. -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box ">
                            <p:graphicImage url="../resources/images/dashboard/effect-filessynced.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/plants.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">PLANTS UNDER CARE</span>
                                <h3>
                                    <h:outputText value="#{sensorStationListController.sensorStationsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                    <!-- .............MEASUREMENTS............... -->

                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box">
                            <p:graphicImage url="../resources/images/dashboard/effect-messages.svg"/>
                            <span class="overview-icon">
                                <p:graphicImage url="../resources/images/dashboard/measurements.png"/>
                            </span>
                            <div class="overview">
                                <span class="overview-title">MEASUREMENTS</span>
                                <h3>
                                    <h:outputText value="#{measurementListController.measurementsAmount}"/>
                                </h3>
                            </div>
                        </div>
                    </div>

                </c:if>


                <!-- ....................................ADMIN VIEW START................................... -->
                <c:if test="#{sessionInfoBean.hasRole('ADMIN')}">

                    <!-- ..........GRAPH................ -->
                    <div class="col-12 md:col-12 xl:col-6">
                        <div class="card chart">
                            <div class="card-header">
                                <h5>Selected GreenHouse Details</h5>
                            </div>
                            <div class="card">
                                <p:barChart id="myBarChart" model="#{graphController.barModel}"/>

                            </div>
                        </div>
                    </div>




                <!-- ..........GREENHOUSES PREVIEW........... -->
                    <div class="col-12 md:col-12 xl:col-6">
                        <div class="col-12">
                            <div class="card">
                                <h5>Green Houses</h5>
                                <p:dataTable id="ordersTable" var="sensorStation"
                                             value="#{sensorStationListController.sensorStationList}" selectionMode="single"
                                             reflow="true" paginatorPosition="bottom"
                                             rowKey="#{sensorStation.sensorStationName}" paginator="true" rows="6"
                                             sortBy="#{sensorStation.sensorStationName}" sortOrder="descending">

                                    <!-- ...........ROW SELECTION EVENT................ -->
                                    <p:ajax event="rowSelect" update="myBarChart"
                                            listener="#{graphController.onRowSelect}"/>

                                    <p:column headerText="Id" sortBy="#{sensorStation.sensorStationName}">
                                        <h:outputText value="#{sensorStation.id}"/>
                                    </p:column>

                                    <p:column headerText="Plant" sortBy="#{sensorStation.plant}">
                                        <h:outputText value="#{sensorStation.plant}"/>
                                    </p:column>

                                    <!-- ...TODO........THIS HAS TO CHANGE WITH PLANT DATE!!!!!!!!......... -->
                                    <p:column headerText="Date" sortBy="#{sensorStation.createDate}">
                                        <h:outputText value="#{sensorStation.createDate}"/>
                                    </p:column>

                                    <p:column headerText="Location" sortBy="#{sensorStation.location}">
                                        <h:outputText value="#{sensorStation.location}">
                                        </h:outputText>
                                    </p:column>


                                    <p:column headerText="Alarm Status">
                                        <i class="#{measurementListController.getMeasurementTypeIcon('AIR_PRESSURE')}"
                                           style="color:#{measurementListController.getSensorStatus('AIR_PRESSURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Air Pressure"></i>
                                        <i class="#{measurementListController.getMeasurementTypeIcon('TEMPERATURE')}"
                                           style="color:#{measurementListController.getSensorStatus('TEMPERATURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Temperature"></i>
                                        <i class="#{measurementListController.getMeasurementTypeIcon('SOIL_MOISTURE')}"
                                           style="color:#{measurementListController.getSensorStatus('SOIL_MOISTURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Soil Moisture"></i>
                                        <i class="#{measurementListController.getMeasurementTypeIcon('AIR_QUALITY')}"
                                           style="color:#{measurementListController.getSensorStatus('AIR_QUALITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Air Quality"></i>
                                        <i class="#{measurementListController.getMeasurementTypeIcon('LIGHT_INTENSITY')}"
                                           style="color:#{measurementListController.getSensorStatus('LIGHT_INTENSITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Light Intensity"></i>
                                        <i class="#{measurementListController.getMeasurementTypeIcon('HUMIDITY')}"
                                           style="color:#{measurementListController.getSensorStatus('HUMIDITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                           title="Humidity"></i>
                                    </p:column>

                                    <p:column style="width: 3.5rem">

                                        <!-- ...........BUTTON TO OPEN DETAILVIEW OF SELECTED SENSOR STATION......... -->
                                        <p:button icon="pi pi-search"
                                                  title="open Detail-View"
                                                  href="/greenHouseDetails.xhtml?id=#{sensorStation.sensorStationName}"/>

                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </div>
                </c:if>
                <!-- ....................................ADMIN VIEW FINISH................................... -->













                <!-- ....................................GARDENER VIEW START................................... -->
                <c:if test="#{sessionInfoBean.hasRole('GARDENER')}">  <!-- ........................not needed?................... -->
                <!-- ..........GRAPH................ -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="card chart">
                        <div class="card-header">
                            <h5>Selected Sensor Station Details</h5>
                        </div>
                        <div class="card">
                            <p:barChart id="myBarChart2" model="#{graphController.barModel}"/>

                        </div>
                    </div>
                </div>
                <!-- ......simply modify the graph controller do display different data....... -->
                <!-- ......supported charts are .lineModel and .cartesianLinearModel...... -->


                <!-- ..........GARDENER VIEW........... -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Assigned Sensor Stations</h5>
                                <div class="header-buttons">
                                    <!-- ........................Help Button ....................... -->
                                    <p:commandButton type="button" icon="fa fa-duotone fa-seedling" title="Help"
                                                     styleClass="ui-button-secondary outlined-button"
                                                     onclick="PF('gardenerDhelpDialog').show()"/>
                                </div>
                            </div>

                            <p:dataTable id="ordersTable2" var="sensorStation"
                                         value="#{sensorStationListController.assignedSensorStationList}" selectionMode="single"
                                         reflow="true" paginatorPosition="bottom"
                                         rowKey="#{sensorStation.sensorStationName}" paginator="true" rows="5"
                                         sortBy="#{sensorStation.sensorStationName}" sortOrder="descending">

                                <!-- ...........ROW SELECTION EVENT................ -->
                                <p:ajax event="rowSelect" update="myBarChart2"
                                        listener="#{graphController.onRowSelect}"/>

                                <p:column headerText="Id" sortBy="#{sensorStation.sensorStationName}" filterBy="#{sensorStation.sensorStationName}">
                                    <h:outputText value="#{sensorStation.id}"/>
                                </p:column>
                                <p:column headerText="Plant" sortBy="#{sensorStation.plant}" filterBy="#{sensorStation.plant}">
                                    <h:outputText value="#{sensorStation.plant}"/>
                                </p:column>
                                <p:column headerText="Location" sortBy="#{sensorStation.location}" filterBy="#{sensorStation.location}">
                                    <h:outputText value="#{sensorStation.location}">
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Alarm Status">
                                    <i class="#{measurementListController.getMeasurementTypeIcon('AIR_PRESSURE')}"
                                       style="color:#{measurementListController.getSensorStatus('AIR_PRESSURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Air Pressure"></i>
                                    <i class="#{measurementListController.getMeasurementTypeIcon('TEMPERATURE')}"
                                       style="color:#{measurementListController.getSensorStatus('TEMPERATURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Temperature"></i>
                                    <i class="#{measurementListController.getMeasurementTypeIcon('SOIL_MOISTURE')}"
                                       style="color:#{measurementListController.getSensorStatus('SOIL_MOISTURE',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Soil Moisture"></i>
                                    <i class="#{measurementListController.getMeasurementTypeIcon('AIR_QUALITY')}"
                                       style="color:#{measurementListController.getSensorStatus('AIR_QUALITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Air Quality"></i>
                                    <i class="#{measurementListController.getMeasurementTypeIcon('LIGHT_INTENSITY')}"
                                       style="color:#{measurementListController.getSensorStatus('LIGHT_INTENSITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Light Intensity"></i>
                                    <i class="#{measurementListController.getMeasurementTypeIcon('HUMIDITY')}"
                                       style="color:#{measurementListController.getSensorStatus('HUMIDITY',sensorStation) == 'OK' ? 'green' : 'red'}"
                                       title="Humidity"></i>
                                </p:column>
                                <p:column style="width: 3.5rem">
                                    <!-- ...........BUTTON TO OPEN DETAILVIEW OF SELECTED SENSOR STATION......... -->
                                    <p:button icon="pi pi-search"
                                              title="open Detail-View"
                                              href="/greenHouseDetails.xhtml?id=#{sensorStation.sensorStationName}"/>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
            </c:if>
                <!-- ....................................GARDENER VIEW FINISH................................... -->















                <!-- ....................................USER VIEW ................................... -->
                <h:form id="userForm">
                    <div class="col-12">
                        <div class="card">

                            <div class="card-header">
                                <h4>Followed Plants</h4>
                                <div class="header-buttons">
                                    <!-- ........................Help Button ....................... -->
                                    <p:commandButton type="button" icon="fa fa-duotone fa-seedling" title="Help"
                                                 styleClass="ui-button-secondary outlined-button"
                                                 onclick="PF('userDhelpDialog').show()"/>
                                </div>
                            </div>

                            <p:dataTable id="plantsTable" var="plant" value="#{plantController.followedPlantsList}" paginator="true" rows="3" paginatorPosition="bottom" rowKey="#{plant.id}">

                                <p:ajax event="rowToggle"/>

                                <p:column style="width:2rem">
                                    <p:rowToggler/>
                                </p:column>
                                <p:column >
                                    <p:graphicImage url="../resources/images/plant1.jpg" styleClass="shadow-2" width="100"/>
                                </p:column>
                                <p:column headerText="Plant" sortBy="#{plant.plantName}" filterBy="#{plant.plantName}">
                                    <h:outputText value="#{plant.plantName}"/>
                                </p:column>
                                <p:column headerText="Planted Date" sortBy="#{plant.plantedDate}" filterBy="#{plant.plantedDate}">
                                    <h:outputText value="#{plant.plantedDate}"/>
                                </p:column>
                                <p:column headerText="Description" sortBy="#{plant.description}" filterBy="#{plant.description}">
                                    <h:outputText value="#{plant.description}"/>
                                </p:column>
                                <p:column >
                                    <!-- ........................Unfollow Button ....................... -->
                                    <p:commandButton style="border-color: red; background-color: red"
                                                     icon="pi pi-minus"
                                                     title="Unfollow Plant"
                                                     update=":userForm:plantsTable">
                                        <p:ajax event="click" listener="#{userDetailController.doRemovePlantFromFollowedPlants(plant)}"/>
                                    </p:commandButton>
                                </p:column>
                                <!-- ........................Plant Page Button ....................... -->
                                <p:column>
                                <p:button icon="pi pi-search"
                                          title="Show Plant Page"
                                          href="/plantPage.xhtml?id=#{plant.plantID} "/>
                                </p:column>

                                <!-- .........................................ROW EXPANSION.......................................................... -->
                                <p:rowExpansion>
                                    <div class="card">
                                        <h5>Latest Measurements</h5>
                                        <p:dataTable var="measurement" value="#{measurementService.getLatestPlantMeasurements(plant)}" reflow="true" rowKey="#{measurement.id}">
                                            <p:column headerText="Type" sortBy="#{measurement.type}">
                                                <h:outputText value="#{measurement.type}" />
                                            </p:column>

                                            <p:column headerText="Value" sortBy="#{measurement.value_s}">
                                                <h:outputText value="#{measurement.value_s}" />
                                            </p:column>

                                            <p:column headerText="Unit" sortBy="#{measurement.unit}">
                                                <h:outputText value="#{measurement.unit}">
                                                    <f:convertNumber currencySymbol="$" type="currency" />
                                                </h:outputText>
                                            </p:column>

                                            <p:column  headerText="Status" >
                                                <h:form rendered="#{not empty measurement.id}">
                                                <i class="#{measurementListController.getMeasurementTypeIcon(measurement.type)}"
                                                   style="display: flex; justify-content: center; align-items: center; color:#{measurementListController.getSensorStatus(measurement.type,measurement.sensorStation) == 'OK' ? 'green' : 'red'}"
                                                   title="#{measurement.type}"></i>
                                                </h:form>
                                            </p:column>

                                        </p:dataTable>
                                    </div>
                                </p:rowExpansion>

                            </p:dataTable>


                            <!-- .......::::::::::::::::...GALLERY ....::::::::::::::::::::::.......... -->
                            <div class="card">
                                <p:galleria widgetVar="galleria1" value="#{galleryController.images}" var="image"
                                            numVisible="9"
                                            circular="true" fullScreen="true" showItemNavigators="true"
                                            style="max-width: 70%">
                                    <p:graphicImage value="#{galleryController.photoAsStreamedContent}"
                                                    alt="#{galleryController.photoAsStreamedContent}"
                                                    style="width: 100%; display: block">
                                        <f:param name="id" value="#{image.id}"/>
                                    </p:graphicImage>
                                </p:galleria>
                            </div>


                        </div>
                    </div>
                </h:form>
                <!--.......................................................USER VIEW FINISH.........................................-->








                <!--.......................................................ADMIN LOG.........................................-->
                <c:if test="#{sessionInfoBean.hasRole('ADMIN')}">

                    <!-- ..........OUTER FRAME LOG SYSTEM MESSAGES AND LOGS .............. -->
                    <div class="col-12">
                        <div class="grid">


                            <!-- ...........AUDIT LOG FRAME ........... -->
                            <div >
                                <div class="card status">
                                    <h:outputLink value="/admin/auditLog.xhtml">
                                        <h5 style="text-align: center; color: grey;">Audit Logs</h5>
                                    </h:outputLink>

                                    <div class="status-content">


                                        <!-- .......AUDIT LOG PREVIEW ....... -->
                                        <div class="card">
                                            <p:dataTable id="logs" var="log" value="#{logController.latestLogs}"
                                                         reflow="true" paginatorPosition="bottom"
                                                         rowKey="#{log.id}" paginator="true" rows="10" sortBy="#{log.id}"
                                                         sortOrder="descending">
                                                <p:column>
                                                    <h:outputText value="#{log.type}"
                                                                  style="color:#{log.type == 'ERROR' ? 'red' : log.type == 'WARNING' ? 'orange' : 'green'};"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{log.time}"/>
                                                </p:column>
                                                <p:column>
                                                    <h:outputText value="#{log.text}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </div>


                                        <!-- .............LOG CATEGORIES ......... -->
                                        <div class="status-info">
                                            <h6>Logs</h6>
                                            <ul>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-info"></i> Total Amount</span>
                                                        <span>
                                                            <h:outputText value="#{logController.logsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on"
                                                                 style="color: red"></i> Error</span>
                                                        <span>
                                                            <h:outputText value="#{logController.errorLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on" style="color: orange"></i> Warning</span>
                                                        <span>
                                                            <h:outputText value="#{logController.warningLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="status">
                                                        <span><i class="pi pi-circle-on"
                                                                 style="color: green"></i> Success</span>
                                                        <span>
                                                            <h:outputText value="#{logController.successLogsAmount}"/>
                                                        </span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div><!-- ......LOG CATEGORIES END..... -->

                                    </div>
                                </div>
                            </div><!-- .......AUDIT LOG FRAME END....... -->


                        </div>
                    </div><!-- ..END OF OUTER FRAME SYSTEM MESSAGES AND LOGS .......-->



                </c:if>
                <!--.....................................................ADMIN LOG FINISHED............................................-->
            </div>
        </div>













        <!-- ....................................... HELP DIALOGS...................................................................... -->
        <!-- ...................................UserDashboard help dialog............................. -->
        <p:dialog header="User Dashboard Help" id="userDhelpDialog" widgetVar="userDhelpDialog"
                  modal="true"
                  showEffect="fade" hideEffect="fade" resizable="false">

            <p:outputPanel id="UserDhelpDialog">
                <h5>Getting Started</h5>
                <p>On this page you can keep track of your followed plants and visit their respective plant pages to see their gallery description and latest measurements,<br></br>
                    or you can unfollow them by clicking on the - button.<br></br>
                To add a plant to your followed plants visit Plant Catalogue.</p>
                <h6>About following unfollowing</h6>
                When a plant dies and is finally deleted you will be automatically unfollowed , as long as the plant is not
                deleted you will still be able to see its gallery and pictures even if it already died<br></br>
                Use the unfollow button to stop following a plant.<br></br>
                To see all our plants and add them to your followed list vist the Plants Catalogue page.
                <h6>About Plant pages</h6>
                Each of our plants has a dedicated plant page you can visit to see its gallery and latest measurements along with other
                usefull information!<br></br>
                Visit it by pressing the "Show Plant Page" button
            </p:outputPanel>
        </p:dialog>

        <!-- ...................................Gardener Dashboard help dialog............................. -->
        <p:dialog header="Gardener Dashboard Help" id="gardenerDhelpDialog" widgetVar="gardenerDhelpDialog"
                  modal="true"
                  showEffect="fade" hideEffect="fade" resizable="false">

            <p:outputPanel id="GardenerDhelpDialog">
                <p>On this page you can keep track of the Sensor Stations that have been assigned to you, see their Sensors Status and corresponding Graph.</p>
                <h6>About The Details Page</h6>
                By clicking on the associated button you can open the DetailPage , in the detailpage you will have the possibility to:<br></br>
                <br></br>
                See all measurements for the chosen Sensor Station with the corresponding Graphs.<br></br>
                Manage the pictures users take of the plants , Pictures will need your approval before going to the public Plant Gallery.<br></br>
                Edit Things like the location of the sensorStation and the plant displayed.<br></br>
                Remove The Current Pairing And/Or Pair to a new Access Point.<br></br>
                Reset the Alarm Switch .<br></br>
                See all Sensors of the chosen Sensor Station with their relative information<br></br>
                Edit Sensors bordervalues aswell as resetting the respective Alarm Counts.<br></br>
                More Detailed Usage infos can be found on the page itself.
                <h6>About The Sensors Status</h6>
                The Status Icons Show if the corresponding Sensor has reached his set treshold alarm count.
                <h6>About The Graph</h6>
                By selecting a Sensor Station the panel on the left will show a graph for the Sensor Station Last Measurements (one per type).
            </p:outputPanel>
        </p:dialog>


















    </ui:define>
</ui:composition>