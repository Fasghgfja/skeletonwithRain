<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/main.xhtml">


    <ui:define name="title">Planthealth: Plant Management</ui:define>

    <ui:define name="viewname">
        <li>Galleria</li>
        <li><i class="pi pi-chevron-right"></i></li>
        <li>
        </li>
    </ui:define>

    <ui:define name="head">

    </ui:define>


    <ui:define name="content">



        <!-- .........................................TABLE.............................................................. -->
        <h:form id="userForm">
            <div class="col-12">
                <!-- ....................PLANT CREATE button..................... -->
                <p:commandButton style="margin-bottom: 10px" value="Create new Plant" rendered="#{sessionInfoBean.hasRole('ADMIN')}" update="plantCreateDialog:createPlantDialog" oncomplete="PF('createPlantDialog').show()"
                                 icon="pi pi-user-plus" title="New User" class="btn btn-primary">
                    <p:resetInput target=":plantCreateDialog:createPlantDialog"/>
                </p:commandButton>

                <div class="card">
                    <h5>Plant Management</h5>
                    <p>From this page it is possible to create/delete and edit a Plant and Generate Qr codes for them</p>
                    <p>Note: By deleting a plant all pictures will be detached and go to general gallery , if the plant is actually followed by users then it will be automatically unfollowed,
                    It is not possible to delete a plant that is currently displayed in a Sensor Station.</p>
                    <p:dataTable id="plantsTable" var="plant" value="#{plantController.plantList}" paginator="true" rows="10" paginatorPosition="bottom" rowKey="#{plant.id}">


                        <p:column headerText="ID" sortBy="#{plant.plantID}">
                            <h:outputText value="#{plant.plantID}"/>
                        </p:column>

                        <p:column headerText="Plant Name" sortBy="#{plant.plantName}">
                            <h:outputText value="#{plant.plantName}"/>
                        </p:column>

                        <p:column headerText="Sensor Station" sortBy="#{plant}">
                            <h:outputText value="#{plant.sensorStation}"/>
                        </p:column>

                        <p:column headerText="Planted Date" sortBy="#{plant}">
                            <h:outputText value="#{plant.plantedDate}"/>
                        </p:column>

                        <p:column style="text-align: center">


                            <!-- ...........BUTTON TO OPEN QR CODE GENERATION PAGE......... -->
                            <p:button style="margin-right: 10px" icon="pi pi-qrcode"
                                      title="Generate QR-Code"
                                      href="/generateQrCode.xhtml?id=#{plant.plantID}">
                            </p:button>

                            <!-- ....................Plant EDIT BUTTON ........... .............. -->
                            <p:commandButton style="margin-right: 10px" update=":userForm:plantEditDialog"
                                             oncomplete="PF('plantEditDialog').show()" icon="pi pi-user-edit" title="Edit">
                                <f:setPropertyActionListener value="#{plant}" target="#{plantController.plant}"/>
                            </p:commandButton>


                            <!-- ....................DELETE PLANT BUTTON ......... .............. -->
                            <p:commandButton style="margin-right: 10px" styleClass="ui-button-danger" rendered="#{sessionInfoBean.hasRole('ADMIN')}"
                                             action="#{plantController.doDeletePlant()}" icon="pi pi-user-minus"
                                             oncomplete="location.reload();"
                                             title="Delete"
                                             update=":userForm:plantsTable">
                                <f:setPropertyActionListener value="#{plant}" target="#{plantController.plant}"/>
                                <p:confirm header="Confirmation"
                                           message="Are you sure that you want to delete the plant '#{plant.plantName}'? You cannot undo this operation. ,
                                           PLANTS ACTUALLY DISPLAYED IN A SENSOR STATION WILL NOT BE REMOVED"
                                           icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>


                        </p:column>

                    </p:dataTable>
                </div>
            </div>



            <!-- ...................................Plant Edit dialog.................................... -->
            <p:dialog header="Edit Plant" id="plantEditDialog" widgetVar="plantEditDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="userData" rendered="#{not empty plantController.plant}">
                    <h5 class="mt-0">Plant Data </h5>
                    <h:panelGrid columns="1">

                        <p:outputLabel for="plantName" value="Plant name:"/>
                        <p:inputText id="plantName" value="#{plantController.plant.plantName}" />

                        <p:outputLabel for="plantDesciption" value="Description:"/>
                        <p:inputText id="plantDesciption" rendered="#{not empty plantController.plant}" value="#{plantController.plant.description}"/>


                    </h:panelGrid>
                    <h:panelGrid columns="3">
                        <p:commandButton value="Save" action="#{plantController.doSavePlant()}"
                                         oncomplete="PF('plantEditDialog').hide();location.reload();" update=":userForm:plantsTable"/>
                        <p:commandButton value="Abort" onclick="PF('plantEditDialog').hide()"/>
                    </h:panelGrid>
                </p:outputPanel>
            </p:dialog>


            <!-- ...................................CONFIRMATION dialog.................................... -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>

        </h:form>







        <!-- ...................................CONFIRMATION DIALOG .................................... -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>





        <!-- ...................................PLANT CREATE dialog.....ADMIN GARDENER ONLY... -->
        <h:form id="plantCreateDialog">

            <p:dialog header="Create New Plant" id="createPlantDialog" widgetVar="createPlantDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:ajax event="close" update="createPlantDialog"/>

                <p:outputPanel id="createPlant">
                    <h:panelGrid columns="2">


                        <p:outputLabel for="plantNameCreation" value="Plant Name:"/>
                        <p:inputText id="plantNameCreation"
                                     placeholder="Required field" value="#{createPlantBean.plantName}" required="true"/>


                        <p:outputLabel for="plantDescrptiom" value="Description:"/>
                        <p:inputText id="plantDescrptiom"
                                     placeholder="description" value="#{createPlantBean.description}" required="false"/>


                        <p:commandButton value="Create"
                                         action="#{createPlantBean.doCreateNewPlant()}"
                                         update=":userForm:plantsTable"
                                         oncomplete="PF('createPlantDialog').hide(); location.reload();"/>
                        <p:commandButton value="Cancel" onclick="PF('createPlantDialog').hide()"/>

                    </h:panelGrid>
                </p:outputPanel>

            </p:dialog>
        </h:form>




    </ui:define>
</ui:composition>
