<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/main.xhtml">


    <ui:define name="title">Planthealth: Plant Management</ui:define>

    <ui:define name="viewname">
        <li>Plant Menagement</li>
        <li><i class="pi pi-chevron-right"></i></li>
        <li>
        </li>
    </ui:define>

    <ui:define name="head">
        <link rel="stylesheet" href="/webjars/font-awesome/6.4.0/css/all.min.css" />
    </ui:define>


    <ui:define name="content">



        <!-- .........................................TABLE.............................................................. -->
        <h:form id="userForm">
            <div class="col-12">



                <div class="card">
                    <!-- ....................PLANT CREATE button..................... -->
                    <p:commandButton style=" margin-right: 5px" value="Create new Plant" rendered="#{sessionInfoBean.hasRole('ADMIN')}" update="plantCreateDialog:createPlantDialog" oncomplete="PF('createPlantDialog').show()"
                                     icon="fa fa-solid fa-leaf" title="New User" class="btn btn-primary" >
                        <p:resetInput target=":plantCreateDialog:createPlantDialog"/>
                    </p:commandButton>


                    <!-- ....................Delete all plants without Sensor Station button..................... -->
                    <p:commandButton style="margin-right: 5px; background-color: red" value="Delete all Plants Without Sensor Station" rendered="#{sessionInfoBean.hasRole('ADMIN')}" oncomplete="location.reload();" action="#{plantListController.deleteAllPlantsWithoutSensorStation()}"
                                     icon="fa fa-solid fa-trash-can" title="New User" class="btn btn-primary">
                        <p:confirm header="Confirmation"
                                   message="Are you sure ? You cannot undo this operation.
                                        All the pictures linked to this plants will be transferred to general gallery"
                                   icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>

                    <!-- ....................Help button...........................BUTTON................................. -->
                    <p:commandButton type="button" icon="fa fa-duotone fa-seedling" title="Help"
                                     styleClass="ui-button-secondary outlined-button"
                                     onclick="PF('SSDialog').show()"/>

                    <p:dataTable id="plantsTable" var="plant" value="#{plantController.plantList}" paginator="true" rows="10" paginatorPosition="bottom" rowKey="#{plant.id}">


                        <p:column headerText="ID" sortBy="#{plant.plantID}" filterBy="#{plant.plantID}">
                            <h:outputText value="#{plant.plantID}"/>
                        </p:column>

                        <p:column headerText="Plant Name" sortBy="#{plant.plantName}" filterBy="#{plant.plantName}">
                            <h:outputText value="#{plant.plantName}"/>
                        </p:column>

                        <p:column headerText="Sensor Station" sortBy="#{plant.sensorStation}" filterBy="#{plant.sensorStation}">
                            <h:outputText value="#{plant.sensorStation}"/>
                        </p:column>

                        <p:column headerText="Planted Date" sortBy="#{plant.plantedDate}" filterBy="#{plant.plantedDate}">
                            <h:outputText value="#{plant.plantedDate}"/>
                        </p:column>

                        <p:column style="text-align: center" headerText="Interactions">


                            <!-- ...........BUTTON TO OPEN QR CODE GENERATION PAGE......... -->
                            <p:button style="margin-right: 2px" icon="pi pi-qrcode"
                                      title="Generate QR-Code"
                                      href="/generateQrCode.xhtml?id=#{plant.plantID}">
                            </p:button>

                            <!-- ....................Plant EDIT BUTTON ........... .............. -->
                            <p:commandButton style="margin-right: 2px" update=":userForm:plantEditDialog"
                                             oncomplete="PF('plantEditDialog').show()" icon="fa fa-solid fa-pen-to-square" title="Edit">
                                <f:setPropertyActionListener value="#{plant}" target="#{plantController.plant}"/>
                            </p:commandButton>


                            <!-- ....................DELETE PLANT BUTTON ......... .............. -->
                            <p:commandButton style="margin-right: 2px" styleClass="ui-button-danger" rendered="#{sessionInfoBean.hasRole('ADMIN')}"
                                             action="#{plantController.doDeletePlant()}" icon="fa fa-solid fa-trash-can"
                                             oncomplete="location.reload();"
                                             title="Delete"
                                             update=":userForm:plantsTable">
                                <f:setPropertyActionListener value="#{plant}" target="#{plantController.plant}"/>
                                <p:confirm header="Confirmation"
                                           message="Are you sure that you want to delete the plant '#{plant.plantName}'? You cannot undo this operation. ,
                                           PLANTS ACTUALLY DISPLAYED IN A SENSOR STATION WILL BE REMOVED"
                                           icon="pi pi-exclamation-triangle"/>
                            </p:commandButton>


                        </p:column>

                    </p:dataTable>
                </div>
            </div>



            <!-- ...................................Plant Edit dialog.................................... -->
            <p:dialog header="Edit Plant" id="plantEditDialog" widgetVar="plantEditDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="userData" rendered="#{not empty plantController.plant}">
                    <h5 class="mt-0">Plant Data </h5>
                    <h:panelGrid columns="1">

                        <p:outputLabel for="plantName" value="Plant name:"/>
                        <p:inputText id="plantName" value="#{plantController.plant.plantName}" />

                        <p:outputLabel for="plantDesciption" value="Description:"/>
                        <p:inputText id="plantDesciption" rendered="#{not empty plantController.plant}" value="#{plantController.plant.description}"/>


                    </h:panelGrid>
                    <h:panelGrid columns="3">
                        <p:commandButton value="Save" action="#{plantController.doSavePlant()}"
                                         oncomplete="PF('plantEditDialog').hide();location.reload();" update=":userForm:plantsTable"/>
                        <p:commandButton value="Abort" onclick="PF('plantEditDialog').hide()"/>
                    </h:panelGrid>
                </p:outputPanel>
            </p:dialog>


            <!-- ...................................CONFIRMATION dialog.................................... -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>

        </h:form>







        <!-- ...................................CONFIRMATION DIALOG .................................... -->
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>





        <!-- ...................................PLANT CREATE dialog.....ADMIN GARDENER ONLY... -->
        <h:form id="plantCreateDialog">

            <p:dialog header="Create New Plant" id="createPlantDialog" widgetVar="createPlantDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:ajax event="close" update="createPlantDialog"/>

                <p:outputPanel id="createPlant">
                    <h:panelGrid columns="2">


                        <p:outputLabel for="plantNameCreation" value="Plant Name:"/>
                        <p:inputText id="plantNameCreation"
                                     placeholder="Required field" value="#{createPlantBean.plantName}" required="true"/>


                        <p:outputLabel for="plantDescrptiom" value="Description:"/>
                        <p:inputText id="plantDescrptiom"
                                     placeholder="description" value="#{createPlantBean.description}" required="false"/>


                        <p:commandButton value="Create"
                                         action="#{createPlantBean.doCreateNewPlant()}"
                                         update=":userForm:plantsTable"
                                         oncomplete="PF('createPlantDialog').hide(); location.reload();"/>
                        <p:commandButton value="Cancel" onclick="PF('createPlantDialog').hide()"/>

                    </h:panelGrid>
                </p:outputPanel>

            </p:dialog>
        </h:form>


        <!-- .................................. Help dialog............................................................................... -->
        <p:dialog header="Plant Menagement Help" id="SSDialog" widgetVar="SSDialog"
                  modal="true"
                  showEffect="fade" hideEffect="fade" resizable="false">
            <p:outputPanel id="SSHelp">

                <h6>Deleting all plants without a sensor station:</h6>
                By clicking on the "Delete all Plants Without Sensor Station" button, it's possible to delete all the plants in the system that are not assigned to a sensor station.
                <h6>Deleting a plant:</h6>
                By clicking on the "Delete" button, it's possible to delete the selected plant.
                Note: all the plant's pictures will be automatically detached and go to the general gallery. If the plant is currently followed by users, it will be automatically unfollowed
                <h6>Creating a plant:</h6>
                By clicking on the "Create new Plant" button, it's possible to create a new plant. "Plant Name" is a mandatory field, while "description" is optional.
                <h6>Editing a plant:</h6>
                By clicking on the "Edit" button, it's possible to edit the name and/or the description of the selected plant.
                <h6>Generating QR code:</h6>
                By clicking on the "Generate QR-Code" button,  you will get redirected to the QR-code page of the selected plant.


            </p:outputPanel>
        </p:dialog>






    </ui:define>
</ui:composition>
