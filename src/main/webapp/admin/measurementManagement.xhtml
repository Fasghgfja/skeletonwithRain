<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/main.xhtml">


    <ui:define name="title">Planthealth: Measurement Management</ui:define>

    <ui:define name="viewname">
        <li>Measurement Management</li>
        <li><i class="pi pi-chevron-right"></i></li>
        <li>
        </li>
    </ui:define>

    <ui:define name="head">

    </ui:define>


    <ui:define name="content">


        <!-- .........................................TABLE.............................................................. -->
        <h:form id="measurementForm">
            <div class="col-12">





                <div class="card">
                    <!-- ..........HEADER.......... -->
                    <div class="card-header">
                        <!-- ...................Help Button................. -->
                        <div class="header-buttons">
                            <h5>Measurement Management</h5>

                            <!-- ....................Delete all Measurement for a given sensor station.BUTTON..................................... -->
                            <p:commandButton style="margin-left:5px; margin-right: 10px" value="Delete all Measurements from to" rendered="#{sessionInfoBean.hasRole('ADMIN')}"  oncomplete="PF('deleteFromToDialog').show()"
                                             icon="pi pi-user-plus" title="Delete measurements" class="btn btn-primary" update=":deleteFromToForm:DeleteMeasurements" >
                            </p:commandButton>

                            <!-- ....................EXTRA: Delete all Measurement for a given sensor station and type...BUTTON.................. -->


                            <!-- ....................Delete all Measurement for a given sensor station..........BUTTON............................ -->
                            <p:commandButton style="margin-right: 10px; background-color: red" value="in development" rendered="#{sessionInfoBean.hasRole('ADMIN')}"
                                             icon="pi pi-user-minus" title="New User" class="btn btn-primary">
                            </p:commandButton>

                            <!-- ....................Help button...........................................BUTTON................................. -->
                            <p:commandButton type="button" icon="pi pi-ellipsis-v" title="Help"
                                             styleClass="ui-button-secondary outlined-button"
                                             onclick="PF('helpDialog').show()"/>
                        </div>
                    </div>
                    <p:dataTable id="myDataTable1" var="measurement"
                                 value="#{measurementListController.measurements}"
                                 selectionMode="single" reflow="true"
                                 rowKey="#{measurement.id}" scrollable="true"
                                 scrollHeight="500px" rows="100" paginator="true" paginatorPosition="bottom"
                                 styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines">

                        <p:column headerText="Sensor Station" sortBy="#{measurement.sensorStation}" filterBy="#{measurement.sensorStation.sensorStationName}">
                            <h:outputText value="#{measurement.sensorStation}"/>
                        </p:column>
                        <p:column headerText="Measurement" sortBy="#{measurement.value_s}"
                                  filterBy="#{measurement.value_s}">
                            <h:outputText style="vertical-align: middle; margin-left: .5rem"
                                          value="#{measurement.value_s} #{measurement.unit}"/>
                        </p:column>
                        <p:column headerText="Time" sortBy="#{measurement.timestamp}"
                                  filterBy="#{measurement.timestamp}">
                            <h:outputText value="#{measurement.readableTimestamp}"/>
                        </p:column>
                        <p:column headerText="Type" sortBy="#{measurement.type}">
                            <h:outputText value="#{measurement.type}"/>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
















        </h:form>






        <!-- ...................................CONFIRMATION DIALOG .................................... -->
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
        </p:confirmDialog>




















        <!-- ...................................Delete from To dialog........................ -->
        <h:form id="deleteFromToForm">

            <p:dialog header="delete From Date To Date" id="deleteFromToDialog" widgetVar="deleteFromToDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:ajax event="close" update="deleteFromToForm"/>

                <p:outputPanel id="DeleteMeasurements">
                    <h:panelGrid columns="2">


                        <p:outputPanel id="eventDetails" styleClass="ui-fluid">
                            <div class="field">
                                <p:outputLabel for="fromDate" value="fromDate" />
                                <p:datePicker id="fromDate" value="#{measurementListController.event.startDate}" pattern="yyyy-MM-dd" showTime="true"  appendTo="@(body)"  />
                            </div>
                            <div class="field">
                                <p:outputLabel for="toDate" value="toDate" />
                                <p:datePicker id="toDate" value="#{measurementListController.event.endDate}" pattern="yyyy-MM-dd" showTime="true"  appendTo="@(body)" />
                            </div>
                        </p:outputPanel>


                        <p:commandButton value="Delete"
                                         action="#{measurementListController.deleteFromTo()}"
                                         oncomplete="PF('deleteFromToDialog').hide(); location.reload();">

                        <p:confirm header="Confirmation"
                                   message="Are you sure ? You cannot undo this operation.
                                        All measurement up to your selected date will be deleted"
                                   icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                        <p:commandButton value="Cancel" onclick="PF('createPlantDialog').hide()"/>

                    </h:panelGrid>
                </p:outputPanel>

            </p:dialog>
        </h:form>














        <!-- .................................. Help dialog.................................... -->
        <p:dialog header="Measurement Management Help" id="helpDialog" widgetVar="helpDialog"
                  modal="true"
                  showEffect="fade" hideEffect="fade" resizable="false">

        <p:outputPanel id="measurementPageHelp">
            From This page you can cancel measurement for a given timeslot or for a sensor station.<br></br>
            <h6>About Deleting for a timeframe:</h6>
            To delete measurement for a given timeframe press the "Delete all Measurements From To" button.<br></br>
            This will open a dialog that will ask you for starting date and an end date.
            If u leave both fields empty nothing will happen.<br></br>
            If u only fill in the "To" field then all measurement in the system up to your given date will be deleted.<br></br>
            If u only fill in the field "From" then all measurement in the system starting from your date up to today will be deleted.<br></br>
            <h6>About Deleting For a sensor station:</h6>
            By Pressing the appropriate button you will be asked to chose a sensor station and a timeframe.<br></br>
            all measurement for that sensorstation in your specified timeframe will be deleted.<br></br>
            WARNING: By leaving both fields empty all measurements for that sensor station will be deleted.<br></br>
            the rest of the delete logic works like the one for deleting for a timeframe explained above.

        </p:outputPanel>
        </p:dialog>







    </ui:define>
</ui:composition>
