<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:po="http://primefaces.org/rain"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/main.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{sensorStationDetailController.init}"/>
    </f:metadata>

    <ui:define name="title">GREENHOUSE DETAILS</ui:define>
    <ui:define name="viewname">
    </ui:define>
    <ui:define name="head">
        <link rel="stylesheet" href="/webjars/font-awesome/6.4.0/css/all.min.css"/>
        <h:outputScript name="js/chart.js"/>
        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>

    </ui:define>

    <ui:define name="content">

        <!-- ..........................................TOP INFO BOXES................................................................... -->
        <h:form>
            <p:toolbar>

                <p:toolbarGroup> <!-- .....TEMPERATURE AIR HUMIDITY GROUND HUMIDITY LIGHT INTENSITY BOXES............................ -->

                    <!-- ...............................TEMPERATURE BOX................................................ -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.onTempClick()}" update="myDataTable1">
                            <div class="card  overview-box">
                                <p:graphicImage name="images/dashboard/effect-useronline.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-usersonline.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">TEMPERATURE</span>
                                    <h3>query</h3>
                                    <span><span>72</span> new measurements since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>

                    <!-- ...............................AIR HUMIDITY BOX............................................... -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.onAirHumidityClick()}" update="myDataTable1">
                            <div class="card overview-box">
                                <p:graphicImage name="images/dashboard/effect-checkins.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-checkins.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">AIR HUMIDITY</span>
                                    <h3>532</h3>
                                    <span><span>48</span> new city since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>

                    <!-- ...............................GROUND HUMIDITY BOX............................................ -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.onGroundHumidityClick()}"
                                       update="myDataTable1">
                            <div class="card overview-box ">
                                <p:graphicImage name="images/dashboard/effect-filessynced.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-filessynced.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">GROUND HUMIDITY</span>
                                    <h3>12.6%</h3>
                                    <span><span>1.8%</span> increase since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>

                    <!-- ...............................LIGHT INTENSITY BOX............................................ -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.onLightIntensityClick()}"
                                       update="myDataTable1">
                            <div class="card overview-box">
                                <p:graphicImage name="images/dashboard/effect-messages.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-messages.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">LIGHT INTENSITY</span>
                                    <h3>440</h3>
                                    <span><span>24</span> new since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div><!-- ...............................LIGHT INTENSITY BOX END.................................. -->


                </p:toolbarGroup>



                <!-- ........................................PLANT GALLERY  BOX................................................................ -->
                <p:toolbarGroup>
                            <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-messages.png"/>
                        </span>
                    <div class="overview">
                        <!-- .......::::::::::::::::...PLANT GALLERY FORM ....::::::::::::::::::::::................ -->
                        <h:form id="myform">
                            <!-- .......::::.TEXT AND BUTTONS ....::.......... -->
                            <p:commandButton rendered="#{not empty sensorStationDetailController.doGetPlantImages()}" id="b1" value="Show Plant Gallery"
                                             icon="pi pi-external-link"
                                             onclick="PF('galleria1').show()"/>
                            <!-- .......:::::APPROVED PICTURES GALLERY ....:::::.......... -->
                            <div class="card">
                                <p:galleria widgetVar="galleria1" value="#{sensorStationDetailController.doGetPlantImages()}" var="image"
                                            numVisible="9"
                                            circular="true" fullScreen="true" showItemNavigators="true"
                                            style="max-width: 70%" >
                                    <p:commandButton icon="fa-sharp fa-solid fa-trash" title="Delete #{image}" style="width: 10%; height: 10%; background-color: red; position: absolute; margin-left: 90%; margin-bottom: 68%"
                                                     actionListener="#{galleryController.doDeleteImage(image)}"
                                                     />

                                    <p:graphicImage value="#{galleryController.photoAsStreamedContent}"
                                                    alt="#{galleryController.photoAsStreamedContent}"
                                                    style="width: 100%; display: block">
                                        <f:param name="id" value="#{image.id}"/>
                                    </p:graphicImage>
                                </p:galleria>
                            </div>
                        </h:form> <!-- .......::::::::::::::::...PLANT GALLERY FORM END....:::::::::::::::.......... -->
                    </div>
                </p:toolbarGroup> <!-- ............................PLANT GALLERY  BOX END...................................................... -->


                <p:toolbarGroup>

                    <!-- ...............................AIR PRESSURE BOX............................................... -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.onAirPressureClick()}" update="myDataTable1">
                            <div class="card  overview-box">
                                <p:graphicImage name="images/dashboard/effect-useronline.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-usersonline.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">AIR PRESSURE</span>
                                    <h3>queue</h3>
                                    <span><span>72</span> new users since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>

                    <div class="col-12 md:col-6 xl:col-3">
                        <!-- ...............................AIR QUALITY BOX............................................ -->
                        <p:commandLink action="#{measurementListController.onAirQualityClick()}" update="myDataTable1">
                            <div class="card overview-box">
                                <p:graphicImage name="images/dashboard/effect-checkins.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-checkins.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">AIR QUALITY</span>
                                    <h3>532</h3>
                                    <span><span>48</span> new city since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>

                    <!-- ...............................Pic Approval Box............................................... -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <div class="card overview-box ">
                            <p:graphicImage name="images/dashboard/effect-filessynced.svg"/>
                            <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-filessynced.png"/>
                        </span>
                            <div class="overview">
                                <span class="overview-title">Pic Awaiting Approval</span>
                                <h3>

                                    <!-- .......::::::::::::::::...AWAITING APPROVAL GALLERY FORM ....::::::::::::::::::::::.......... -->
                                    <h:form id="myform2">
                                        <!-- .......::::::::::::::::...TEXT AND BUTTONS ....::::::::::::::::::::::.......... -->

                                        <p:commandButton rendered="#{not empty sensorStationDetailController.doGetPlantImagesNotYetApproved()}" id="b2" value="Show " icon="pi pi-external-link"
                                                         onclick="PF('galleria2').show()"/>


                                        <!-- .......::::::::::::::::...AWAITING APPROVAL GALLERY ....::::::::::::::::::::::.......... -->
                                        <div class="card">
                                            <p:galleria id="awaitingapproval" widgetVar="galleria2" value="#{sensorStationDetailController.doGetPlantImagesNotYetApproved()}" var="image"
                                                        numVisible="9"
                                                        circular="true" fullScreen="true" showItemNavigators="true"
                                                        style="max-width: 70%" >
                                                <p:commandButton icon="fa-regular fa-thumbs-up" title="Approve Image #{image}" style="width: 10%; height: 10%; position: absolute; margin-right: 90%"
                                                                 actionListener="#{galleryController.approveImage(image)}"
                                                                 update="awaitingapproval"
                                                />
                                                <p:commandButton icon="fa-sharp fa-solid fa-trash" title="Delete #{image}" style="width: 10%; height: 10%; background-color: red; position: absolute; margin-left: 90%;"
                                                                 actionListener="#{galleryController.doDeleteImage(image)}"
                                                                 update="awaitingapproval"
                                                />
                                                <p:graphicImage value="#{galleryController.photoAsStreamedContent}"
                                                                alt="#{galleryController.photoAsStreamedContent}"
                                                                style="width: 100%; display: block">
                                                    <f:param name="id" value="#{image.id}"/>
                                                </p:graphicImage>
                                            </p:galleria>
                                        </div>

                                    </h:form>
                                </h3>
                                <span><span>25</span>new increase since last visit</span>
                            </div>
                        </div>
                    </div>


                    <!-- ...............................TIME OF LAST MEASUREMENT BOX.................................... -->
                    <div class="col-12 md:col-6 xl:col-3">
                        <p:commandLink action="#{measurementListController.reSetType()}" update="myDataTable1">
                            <div class="card overview-box">
                                <p:graphicImage name="images/dashboard/effect-messages.svg"/>
                                <span class="overview-icon">
                            <p:graphicImage name="images/dashboard/icon-messages.png"/>
                        </span>
                                <div class="overview">
                                    <span class="overview-title">MOST RECENT MEASUREMENT</span>
                                    <h3>440</h3>
                                    <span><span>24</span> new since last visit</span>
                                </div>
                            </div>
                        </p:commandLink>
                    </div>


                </p:toolbarGroup>


            </p:toolbar>
        </h:form><!-- ..........................................TOP INFO BOXES FORM END................................................ -->











        <!-- ..........................................PAGE............................................................................ -->
        <div class="layout-dashboard">
            <div class="grid">

                <!-- ..........................................GRAPH................................................................... -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="card chart">
                        <div class="card-header">
                            <h5>Selected Measurement type History Graph</h5>
                        </div>
                        <div class="card">
                            <p:lineChart id="mylineChart" model="#{graphController.lineModel}"/>
                        </div>
                    </div>
                </div>
                <!-- ...................simply modify the graph controller do display different data................... -->
                <!-- ...................supported charts are .lineModel and .cartesianLinearModel................... -->


                <!-- .........................................MEASUREMENTS TABLE...................................................... -->
                <div class="col-12 md:col-12 xl:col-6">
                    <div class="card products">
                        <p:dataTable id="myDataTable1" widgetVar="customersDT2" var="measurement"
                                     value="#{measurementListController.getMeasurementsForSensorStation()}"
                                     selectionMode="single" reflow="true"
                                     rowKey="#{measurement.sensorStation.sensorStationName}" scrollable="true" scrollHeight="350"
                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines">

                            <!-- ........THIS CAN BE ADDED TO ANY INTERACTIVE ELEMENT TO REFRESH SOMETHING............ -->
                            <p:ajax event="rowSelect" update="mylineChart"
                                    listener="#{graphController.onRowSelectLineChart}"/>

                            <f:facet name="header">
                                <div class="customers-table-header">
                                    <span style="font-weight: bold">Last measurements</span>

                                    <span class="ui-input-icon-left filter-container">
                                        <i class="pi pi-search"/>
                                        <p:inputText id="globalFilter" onkeyup="PF('customersDT2').filter()"
                                                     placeholder="Search"/>
                                    </span>
                                </div>
                            </f:facet>
                            <p:column headerText="Sensor Station" sortBy="#{measurement.sensorStation.sensorStationName}"
                                      filterBy="#{measurement.sensorStation.sensorStationName}">
                                <h:outputText value="#{measurement.sensorStation.sensorStationName}"/>
                            </p:column>
                            <p:column headerText="Plant" sortBy="#{measurement.plant.plantName}"
                                      filterBy="#{measurement.plant.plantName}">
                                <h:outputText style="vertical-align: middle; margin-left: .5rem"
                                              value="#{measurement.plant.plantName}"/>
                            </p:column>
                            <p:column headerText="Measurement" sortBy="#{measurement.value_s}"
                                      filterBy="#{measurement.value_s}">
                                <h:outputText style="vertical-align: middle; margin-left: .5rem"
                                              value="#{measurement.value_s} #{measurement.unit}"/>
                            </p:column>
                            <p:column headerText="Date" sortBy="#{measurement.timestamp}"
                                      filterBy="#{measurement.timestamp}">
                                <h:outputText value="#{measurement.timestamp}"/>
                            </p:column>
                            <p:column headerText="Status">
                                <i class="#{sensorStationDetailController.getlastMeasurementStatusIcon(measurement.type)}"
                                   style="display: flex; justify-content: center; align-items: center; color:#{sensorStationDetailController.getMeasurementStatus(measurement.id,measurement.type) == 'OK' ? 'green' : 'red'}"
                                   title="#{measurement.type}"></i>
                            </p:column>
                            <p:column headerText="Type" sortBy="#{measurement.type}">
                                <h:outputText value="#{measurement.type}"/>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>


                <!-- .........................................GARDENER/STAFF GREENHOUSE SETTINGS PANEL................................................................... -->

                <div class="col-12 md:col-6 xl:col-4">
                    <div class="card tasks">
                        <div class="card-header">
                            <h5>Edit Sensor Station (Gardener only panel)</h5>
                        </div>

                        <!-- ................ EDIT FIELDS PANEL............-->
                        <div class="field col-12 md:col-4">
                            <p:outputPanel id="stationData" rendered="#{not empty sensorStationDetailController.sensorStation}">
                                <h5 class="mt-0">Sensor Station Data </h5>
                                <h:panelGrid columns="1">

                                    <p:outputLabel for="sensorStationAccessPoint" value="Access Point:"/>
                                    <p:selectOneMenu id="sensorStationAccessPoint" filter="true" emptyLabel="Access Point ID"
                                                     scrollHeight="250" updateLabel="true" >
                                        <f:selectItems value="#{accessPointController.accessPoints}"/>
                                        <f:facet name="footer">
                                            <p:divider styleClass="mt-0" />
                                            <h:outputText value="3 options" style="font-weight:bold;"/>
                                        </f:facet>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="sensorStationId" value="Sensor-station name:"/>
                                    <p:inputText id="sensorStationId" value="#{sensorStationDetailController.sensorStation.sensorStationName}" disabled="true" />

                                    <p:outputLabel for="sensorStationPlant" value="Plant: "/>
                                    <p:selectOneMenu id="sensorStationPlant" value="#{sensorStationDetailController.sensorStation.plant}"  filter="true" emptyLabel="Plant: #{sensorStationDetailController.sensorStation.plant.plantName}"
                                                     scrollHeight="250" updateLabel="true" >
                                        <f:selectItems value="#{plantController.plants}"/>
                                        <f:facet name="footer">
                                            <p:divider styleClass="mt-0" />
                                            <h:outputText value="3 options" style="font-weight:bold;"/>
                                        </f:facet>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="sensorStationlocation" value="Sensor-station location:"/>
                                    <p:inputText id="sensorStationlocation" rendered="#{not empty sensorStationDetailController.sensorStation}" value="#{sensorStationDetailController.sensorStation.location}"/>



                                </h:panelGrid>
                            </p:outputPanel>
                        </div>



                    </div>
                </div>





                <!-- .........................................SENSORS PANEL.............................................................. -->

                <div class="col-12 md:col-12 xl:col-8">
                    <div class="card transactions">
                        <div class="card-header">
                            <h5>Sensors</h5>
                            <div class="header-buttons">
                                <p:commandButton type="button" icon="pi pi-search"
                                                 styleClass="ui-button-secondary outlined-button  mr-2"/>
                                <p:commandButton type="button" icon="pi pi-ellipsis-v"
                                                 styleClass="ui-button-secondary outlined-button "/>
                            </div>
                        </div>
                        <h:form id="form">
                            <p:dataTable id="ordersTable" var="sensor" value="#{sensorListController.getSensorsForSensorStation()}"
                                         selectionMode="single" reflow="true" paginatorPosition="bottom"
                                         rowKey="#{sensor.id}" paginator="true" rows="5" sortBy="#{sensor.id}"
                                         sortOrder="descending">

                                <p:column headerText="id: only in testing phase" sortBy="#{sensor.id}">
                                    <h:outputText  value="#{sensor.id}"/>
                                </p:column>

                                <p:column headerText="type" sortBy="#{sensor.type}">
                                    <h:outputText  value="#{sensor.type}"/>
                                </p:column>

                                <p:column headerText="upper border(test)" sortBy="#{sensor.upper_border}">
                                    <h:outputText  value="#{sensor.upper_border}"/>
                                </p:column>

                                <p:column headerText="lower border(test)" sortBy="#{sensor.lower_border}">
                                    <h:outputText  value="#{sensor.lower_border}"/>
                                </p:column>

                                <p:column headerText="Alarm Count" sortBy="#{sensor.alarm_count}">
                                    <h:outputText value="#{sensor.alarm_count}"/>
                                </p:column>

                            </p:dataTable>


                        </h:form>
                    </div>
                </div>


            </div>
        </div>
    </ui:define>
</ui:composition>